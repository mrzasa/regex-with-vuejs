<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Intro | I can kill your browser with a simple regex</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Intro" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Maciek Rząsa, @mjrzasa, Toptal" />
<meta property="og:description" content="Maciek Rząsa, @mjrzasa, Toptal" />
<link rel="canonical" href="http://localhost:4000/workshop.html" />
<meta property="og:url" content="http://localhost:4000/workshop.html" />
<meta property="og:site_name" content="I can kill your browser with a simple regex" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/workshop.html","headline":"Intro","description":"Maciek Rząsa, @mjrzasa, Toptal","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=d2f0c186cf387a133b8c4bbfd94eb19283424fa8">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="http://localhost:4000/">I can kill your browser with a simple regex</a></h1>
        
        

        <p>Maciek Rząsa, <a href="https://twitter.com/mjrzasa">@mjrzasa</a>, <a href="https://toptal.com">Toptal</a></p>

        <p class="view"><a href="https://github.com/mrzasa">View My GitHub Profile</a></p>

        
      </header>
      <section>

      
<h2 id="intro">Intro</h2>

<p>Test those two simple pages that uses regex:</p>

<ol>
  <li><a href="https://regex-performance.github.io/input-en.html">Simple input, without JS (validation)</a></li>
  <li><a href="https://regex-performance.github.io/vue-en.html">Editable regex (search)</a></li>
</ol>

<h2 id="part-1-warm-up">Part 1: Warm-up</h2>

<h3 id="1-repetition">1. Repetition</h3>

<p><a href="https://regex101.com/r/exsSjf/2">Regex101</a><br />
You need to match HTML tags. (In general case it’s <a href="https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">a bad idea</a> to use regex for HTML parsing, but it’s a good learning example).</p>

<ol>
  <li>Add text inside/after the tag, see if step count changes; see debugger</li>
  <li>Add another tag, see the result</li>
  <li>There are two solutions: limit repetition using lazy quantifier <code class="language-plaintext highlighter-rouge">.*?</code>, or limit scope <code class="language-plaintext highlighter-rouge">[^&gt;]</code>. Try both, add text inside/after the tag, see step count changes</li>
</ol>

<h3 id="2-alternative">2. Alternative</h3>
<p><a href="https://regex101.com/r/WhQqEA/3/">Regex101</a><br />
Optimize regex that finds certain CSS classes related to product: <code class="language-plaintext highlighter-rouge">product-size, product-column, product-info</code>
and product ids that has digits 1,2,3.</p>

<h2 id="part-2-understanding-catastrophe">Part 2: Understanding Catastrophe</h2>

<h3 id="0-artificial-example">0. Artificial example</h3>

<p><a href="https://regex101.com/r/MosMwT/1/">Regex101</a> <br />
Watch the step count and the debugger while doing those changes:</p>
<ol>
  <li>Add more <code class="language-plaintext highlighter-rouge">a</code> at the beginning</li>
  <li>Remove <code class="language-plaintext highlighter-rouge">b</code></li>
</ol>

<h3 id="1-arithmetic-operations">1. Arithmetic operations.</h3>

<p><a href="https://regex101.com/r/qPsP27/3/">Regex101</a><br />
You have a regex matching simple arithmetic operations. Allowed: two numbers
separated with plus or minus sign, ending with equals sign, e.g. <code class="language-plaintext highlighter-rouge">12+34=</code> or <code class="language-plaintext highlighter-rouge">32121-23=</code></p>

<ol>
  <li>Enhance regex to allow 3 numbers and 2 signs (e.g. <code class="language-plaintext highlighter-rouge">12+322-1=</code> ).</li>
  <li>Enhance regex to allow any lenght of the operation (e.g. <code class="language-plaintext highlighter-rouge">12+322-1+223-2323+...=</code>).</li>
  <li>Remove equals sign from the test string, check steps in debugger.</li>
</ol>

<p>When you’re done, go to the <a href="https://regex-performance.github.io/vue-en.html">editable regex demo page</a>
and see impact of hastily written regex on user experience. To see timing stats, open browser console. Optimize the regex (you can start in Regex101 and apply it to the demo page).</p>

<h3 id="3-wrong-way-to-parse-csv">3. Wrong way to parse CSV</h3>

<p><a href="https://regex101.com/r/CAo4Xx/1/">Regex101</a><br />
You have a regex matching 6th column (<code class="language-plaintext highlighter-rouge">Tea</code>) in CSV file (again, there are better ways to parse CSV…). It’s rather slow even for valid input. Optimize it.</p>

<h2 id="part-3-into-the-wild">Part 3: Into the Wild</h2>

<h3 id="1-cloudflare">1. Cloudflare</h3>
<p><a href="https://regex101.com/r/fD4yMi/1/">Regex101</a> <br />
Analyse regex that stopped Cloudflare servers. Optimize it to remove catastrophic backtracking.</p>

<h3 id="2-discourse-customer">2. Discourse customer</h3>
<p><a href="https://regex101.com/r/MDgdC6/1/">Regex101</a> <br />
Analyse regex found by Sam Saffron at code written by a Discourse client. It replaces space before certain characters by HTML thin space (French typography). See how it performs on unexpected input. Optimize it.</p>

<h3 id="3-microsoft">3. Microsoft</h3>
<p><a href="https://regex101.com/r/8gaUFh/1/">Regex101</a> <br />
Analyze regex used in a Microsoft project to match Windows username. Find an input causing catastrophic bactracking. Optimize it.</p>

<h2 id="cheatsheet">Cheatsheet</h2>

<h3 id="operators">Operators:</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">X*</code> greedy quantifier (match as much as possible)</li>
  <li><code class="language-plaintext highlighter-rouge">X*?</code> lazy quantifier (match as little as possible)</li>
  <li><code class="language-plaintext highlighter-rouge">X*+</code>, <code class="language-plaintext highlighter-rouge">X++</code> possessive quantifiers (don’t backtrack)</li>
  <li><code class="language-plaintext highlighter-rouge">X{n}</code> repeat n times</li>
  <li><code class="language-plaintext highlighter-rouge">[XYZ]</code> character set, <code class="language-plaintext highlighter-rouge">[^XYZ]</code> negated character set</li>
  <li><code class="language-plaintext highlighter-rouge">\d</code> digit</li>
  <li><code class="language-plaintext highlighter-rouge">\w</code> word character (digit, letter, underscore)</li>
  <li><code class="language-plaintext highlighter-rouge">^</code> beginning of the line</li>
  <li><code class="language-plaintext highlighter-rouge">(?:...)</code> non-capturing group</li>
</ul>

<h3 id="good-practices">Good practices</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.* =&gt; [^X]*</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">.*? =&gt; [^X]*</code></p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">(pre-d1|pre-e2|...) =&gt; pre-(d1|e2|...)</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">(,|;|\.) =&gt; [,.;]</code></p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">(A+|B?)+ =&gt; A+(BA+)*</code> (unrolling the loop)</li>
  <li><code class="language-plaintext highlighter-rouge">(A+|B?)+ =&gt; (A+B)*A+</code> (unrolling the loop)</li>
  <li><code class="language-plaintext highlighter-rouge">(A+|B?)+ =&gt; (A++|B?)+</code> (avoiding backtracking by using possessive quantifiers)</li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li>Mastering Regular Expressions, 3rd Edition, Jefferey Friedl, 2009</li>
  <li><a href="https://regex101.com/">Regex101 - online regex tester and debugger</a></li>
  <li><a href="https://github.com/kszubrycht/regex-with-vuejs">Test app - original</a> thanks to <a href="https://github.com/kszubrycht">Kamil Szubrycht</a></li>
  <li><a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP on ReDoS</a></li>
  <li><a href="https://medium.com/textmaster-engineering/performance-of-regular-expressions-81371f569698">Maciek Rząsa: Performance of Regular Expressions</a></li>
  <li><a href="http://katafrakt.me/2016/07/06/regular-expressions/">Katafrakt: Regular expression how do they work?</a></li>
  <li><a href="http://nikic.github.io/2012/06/15/The-true-power-of-regular-expressions.html">The true power of regular expressions</a></li>
  <li><a href="https://www.analyticsvidhya.com/blog/2017/11/flashtext-a-library-faster-than-regular-expressions/">FlashText algorithm vs regular epxressions for keyword matching</a></li>
  <li><a href="https://samsaffron.com/archive/2018/01/18/my-production-ruby-on-rails-cpu-is-at-100-now-what">Sam Safron: Debugging 100% CPU usage in production Ruby on Rails systems</a></li>
  <li><a href="https://blog.codinghorror.com/regex-performance/">Jeff Atwood: Regex performance</a></li>
  <li><a href="http://blog.stevenlevithan.com/archives/mimic-atomic-groups">Mimicking atomic groups in JS regex</a></li>
  <li><a href="http://www.rexegg.com">RexEgg - Regex Tutorial</a>, especially:
    <ul>
      <li><a href="http://www.rexegg.com/regex-explosive-quantifiers.html">Explosive quantifiers</a></li>
      <li><a href="http://www.rexegg.com/regex-quantifiers.html">Mastering quantifiers</a></li>
    </ul>
  </li>
  <li><a href="https://www.regular-expressions.info">regular-expressions.info</a>:
    <ul>
      <li><a href="https://www.regular-expressions.info/possessive.html">Possesive quantifiers</a></li>
      <li><a href="https://www.regular-expressions.info/catastrophic.html">Catastrophic backtracking</a></li>
      <li><a href="https://www.regular-expressions.info/engine.html">Regex engine internals</a></li>
    </ul>
  </li>
  <li>Russ Cox regex series:
    <ul>
      <li><a href="https://swtch.com/~rsc/regexp/regexp1.html">Regular Expression Matching Can Be Simple And Fast</a></li>
      <li><a href="https://swtch.com/~rsc/regexp/regexp2.html">Regular Expression Matching: the Virtual Machine Approach</a></li>
      <li><a href="https://swtch.com/~rsc/regexp/regexp3.html">Regular Expression Matching in the Wild</a></li>
      <li><a href="https://swtch.com/~rsc/regexp/regexp4.html">Regular Expression Matching with a Trigram Index</a></li>
    </ul>
  </li>
  <li>Loggly:
    <ul>
      <li><a href="https://www.loggly.com/blog/five-invaluable-techniques-to-improve-regex-performance/">Five invaluable techniques to improve regex performance</a></li>
      <li><a href="https://www.loggly.com/blog/regexes-the-bad-better-best/">Regexes bad, better, best</a></li>
    </ul>
  </li>
  <li>ReDoS cases:
    <ul>
      <li><a href="https://samsaffron.com/archive/2018/01/18/my-production-ruby-on-rails-cpu-is-at-100-now-what">Sam Safron: Debugging 100% CPU usage in production Ruby on Rails systems</a></li>
      <li><a href="https://blog.cloudflare.com/details-of-the-cloudflare-outage-on-july-2-2019/">CloudFlare postmortem (2019)</a></li>
      <li><a href="https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">StackOverflow postmortem (2016)</a></li>
    </ul>
  </li>
  <li>ReDoS research (Virginia Tech):
    <ul>
      <li><a href="https://medium.com/bugbountywriteup/introduction-987fdc4c7b0">Blogpost</a></li>
      <li><a href="http://people.cs.vt.edu/~davisjam/downloads/publications/DavisCoghlanServantLee-EcosystemREDOS-ESECFSE18.pdf">Paper</a></li>
    </ul>
  </li>
</ul>


      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/mrzasa">mrzasa</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-121670409-1', 'auto');
      ga('send', 'pageview');
    </script>
    
  </body>
</html>
